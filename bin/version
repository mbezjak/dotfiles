#!/bin/bash
#

set -o errexit

function color {
    case "$1" in
        red)    tput -Txterm setaf 1 ;;
        green)  tput -Txterm setaf 2 ;;
        yellow) tput -Txterm setaf 3 ;;
        reset)  tput -Txterm sgr0    ;;
        *)      echo "Unknown color: $1"; die ;;
    esac

    return 0
}
function error { color red; echo "$@"; color reset;   }
function msg   { color green; echo "$@"; color reset; }
function die   { exit 1; }
function fail  { error "$@"; die; }
function find-grails-plugin-descriptor {
    find -maxdepth 1 -name '*GrailsPlugin.groovy'
}


if [[ $(find-grails-plugin-descriptor | wc -l) == 1 ]]; then
    declare -r file=$(find-grails-plugin-descriptor)
    awk '/def version/{print $4}' $file | tr -d "'\""

elif [[ -f application.properties ]]; then
    grep app.version application.properties | awk -F= '{print $2}'

elif [[ -f project/Build.scala ]]; then
    awk '/val appVersion/{print $4}' project/Build.scala | tr -d "'\""

elif [[ -f build.gradle ]]; then
    awk '/version =/{print $3}' build.gradle | tr -d "'\""

else
    fail "Do not recognize the project: $(basename $PWD)"
fi

exit 0
