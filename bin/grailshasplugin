#!/bin/bash
#
# Test if grails project has plugin given as argument $1.
# Lists all installed plugins if $1 isn't set.
#
# example:
#  $ grailshasplugin foo

set -o errexit

declare -r plugin="$1"
declare -r project=$(grailsproject directory)
declare -r grailsVersion=$(grailsproject grails)

declare -r inTarget=target/plugins
declare -r inDotGrails="$HOME/.grails/$grailsVersion/projects/$project/plugins"

# output: project_name plugin_version plugin_name
function list {
    # http://stackoverflow.com/questions/2096490/print-second-last-column-field-in-awk
    # http://stackoverflow.com/questions/6271348/regex-to-replace-last-occurrence-of-a-string-in-each-line
    find "$1" -maxdepth 1 -mindepth 1 -printf '%f\n' | \
        sed -e 's|-\([^-]*\)$| \1|' | \
        awk -v project="$project" '/^'"$plugin"'/{print project, $2, $1 }' | \
        column -t
}


if   [[ -d $inTarget ]];    then list $inTarget
elif [[ -d $inDotGrails ]]; then list $inDotGrails
fi

exit 0
