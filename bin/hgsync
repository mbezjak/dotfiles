#!/bin/bash
#

set -o errexit

project=$(basename $PWD)
dirty=$(hg dirty)

if [[ "$dirty" -eq 0 ]]; then
   cin=$(hg cin)
   cout=$(hg cout)

   if [[ "$cin" -eq 0 ]]; then
       if [[ "$cout" -ne 0 ]]; then
           hg --quiet push && echo "$project pushed $cout"
       fi
   elif [[ "$cout" -eq 0 ]]; then
       hg --quiet pull --update && echo "$project pulled $cin"
   else
       echo "$project in $cin out $cout"
   fi
else
    echo "$project dirty $dirty"
fi

exit 0
