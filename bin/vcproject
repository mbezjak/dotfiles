#!/bin/bash
#

set -o errexit

[[ "$1" == "--oneline" ]]      && { oneline=y; shift; }
[[ "$1" == "--git-prefetch" ]] && { prefetch=y; shift; }

[[ -d .hg ]] && cmd=hg || cmd=git
[[ $cmd == git && $prefetch ]] && git fetch --quiet --all

project=$(basename $PWD)
dirty=$($cmd dirty)
cin=$($cmd cin)
cout=$($cmd cout)

# exceptions to the rule
[[ "$project" == .metadata || "$project" == notes ]] && dirty=0

if [[ $oneline ]]; then
  echo "$cmd $project $dirty $cin $cout"
else
  [[ "$dirty" -ne 0 ]] && echo "$project dirty $dirty"
  [[ "$cin"   -ne 0 ]] && echo "$project in $cin"
  [[ "$cout"  -ne 0 ]] && echo "$project out $cout"
fi

exit 0
