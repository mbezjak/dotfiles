#!/bin/bash
#
# Continuous invocation of grailsoverride using inotify.

set -o errexit

[[ -z $(type -P inotifywait) ]] && {
  echo "Package 'inotify-tools' is required" >&2
  exit 1
}

plugin="$1"
[[ "$plugin" != */* ]] && plugin="$HOME/workspace/groovy/$plugin"
grailsoverride "$plugin" > /dev/null

while inotifywait --quiet \
                  --recursive \
                  --event close_write,create,move,delete \
                  --exclude '^\(\..*|.*\.zip|target\)$' \
                  "$plugin"
do
  grailsoverride "$plugin" > /dev/null
done

exit 0
