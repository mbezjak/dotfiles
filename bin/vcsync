#!/bin/bash
#

set -o errexit

read cmd project dirty cin cout <<<$(vcproject --oneline --git-prefetch)

push() {
  if [[ $cmd == hg ]]; then
    hg --quiet push
  else
    git push --quiet
  fi
}

pull() {
  if [[ $cmd == hg ]]; then
    hg --quiet pull --update
  fi # git already fetched
}

if [[ "$dirty" -eq 0 ]]; then
   if [[ "$cin" -eq 0 ]]; then
       if [[ "$cout" -ne 0 ]]; then
           push && echo "$project pushed $cout"
       fi
   elif [[ "$cout" -eq 0 ]]; then
       pull && echo "$project pulled $cin"
   else
       echo "$project in $cin out $cout"
   fi
else
    echo "$project dirty $dirty"
fi

exit 0
