#!/bin/bash
#

set -o errexit

cd ~/Dropbox/lib/anki/main/collection.media
tmp=/tmp/scaled-img
maxw=800
maxh=500

for f in *; do
  if [[ "$f" != latex* ]]; then # ignore latex files
    read w h <<<$(identify -format "%w %h\n" "$f" | head -1) # gifs output >1 line
    if (( w > maxw || h > maxh )); then
      convert "$f" -resize "${maxw}x${maxh}" $tmp
      mv $tmp "$f"
      echo "$f"
    fi
  fi
done

ls -1 | wc --lines

exit 0
