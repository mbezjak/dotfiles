#!/bin/bash
#
# run as:
# $ vc-stub [git|hg]

set -o errexit

### setup parent directory
cmd=${1:-git}
root=/tmp/$cmd-stub
rm -rf $root
mkdir  $root
cd     $root

### DSL functions
run()      { $cmd "$@";   }
cdrepo()   { cd $root/$1; }
newrepo()  { mkdir $root/$1; cdrepo $1; run init; addempty $1 first; }
clone()    { cd $root; run clone $1 $2; }
commit()   { run commit -m "$1"; }
addempty() {
  cdrepo $1; touch $2; run add .
  commit "Add empty file named '$2'."
}
content()  {
  cdrepo $1; echo $3 > $2; run add .
  commit "Change '$2' to: '$3'."
}

### stub

# fast-forward
newrepo  01-main
clone    01-main 01-ff
addempty 01-main a
addempty 01-main b
addempty 01-main c

# rebase-from-main
newrepo  02-main
clone    02-main 02-rebase
addempty 02-rebase a
addempty 02-rebase b
addempty 02-main   c
addempty 02-main   d

# merge-to-main
newrepo  03-main
clone    03-main 03-merge
addempty 03-merge a
addempty 03-merge b
addempty 03-main  c
addempty 03-main  d

# merge conflict
newrepo  04-main
addempty 04-main a
clone    04-main 04-conflict
content  04-main     a "content-from-main"
content  04-conflict a "content-from-conflict"

exit 0
