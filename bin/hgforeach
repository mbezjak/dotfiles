#!/bin/bash
#
# For each mercurial project in workspace execute command given as argument $1.
#
# example:
#  $ hgforeach hgproject
#  # or
#  $ hgforeach hgsync

set -o errexit

IFS=$(echo -en "\n\b") # Internal Field Separator
for project in $(find ~/workspace ~/incubation -mindepth 1 -maxdepth 1 -type d -printf "%p\n")
do
    if [[ -d "$project/.hg" ]]; then # only hg repositories
        cd "$project"
        eval "$@" # potential security problem
    fi
done

exit 0
