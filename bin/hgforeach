#!/bin/bash
#
# for each mercurial project in workspace execute command given as argument $1
#
# example:
#  $ hgforeach hgproject
#  # or
#  $ hgforeach hgsync

set -o errexit

IFS=$(echo -en "\n\b") # Internal Field Separator
for project in $(find ~/workspace -mindepth 2 -maxdepth 2 -type d -printf "%p\n")
do
    if [[ -d "$project/.hg" ]]; then # only hg repositories
        cd "$project"
        eval "$1" # potential security problem
    fi
done

exit 0
